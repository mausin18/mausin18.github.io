<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comentarios del Formulario</title>
  <style>
    /* Variables de color */
    :root {
      --fondo-claro: #f7f7f7;
      --fondo-oscuro: #121212;
      --texto-claro: #333;
      --texto-oscuro: #ffffff;
      --comentario-claro: #ffffff;
      --comentario-oscuro: #2b2b2b;
      --borde-claro: #4CAF50;
      --borde-oscuro: #45a049;
      --boton-claro: #f1f1f1;
      --boton-oscuro: #666;
      --sombra-larga: rgba(0, 0, 0, 0.1);
      --sombra-oscura: rgba(0, 0, 0, 0.3);
      --transicion-suave: 0.3s ease-in-out;
    }

    /* Estilo global */
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--fondo-claro);
      color: var(--texto-claro);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      transition: background-color var(--transicion-suave), color var(--transicion-suave);
    }

    /* T칤tulo */
    h2 {
      font-size: 2.5rem;
      margin-bottom: 30px;
      text-align: center;
      font-weight: 600;
    }

    /* Contenedor de los comentarios */
    #comentarios {
      width: 85%;
      max-width: 900px;
      margin: 20px auto;
      padding: 25px;
      background-color: var(--comentario-claro);
      border-radius: 12px;
      box-shadow: 0 4px 20px var(--sombra-larga);
      max-height: 60vh;
      overflow-y: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
      transition: background-color var(--transicion-suave), box-shadow var(--transicion-suave);
      text-align: center;
    }

    /* Comentarios individuales */
    .comentario {
      background: var(--comentario-claro);
      padding: 20px;
      margin: 15px 0;
      border-radius: 10px;
      box-shadow: 0 4px 12px var(--sombra-larga);
      transition: transform var(--transicion-suave), box-shadow var(--transicion-suave);
      border-left: 6px solid var(--borde-claro);
      opacity: 0;
      animation: fadeIn 1s forwards;
    }

    /* Animaci칩n de aparici칩n de los comentarios */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .comentario:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 16px var(--sombra-oscura);
    }

    /* Bot칩n de cambio de tema */
    .cambiar-tema {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: var(--boton-claro);
      color: var(--texto-claro);
      border: none;
      padding: 12px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 12px var(--sombra-larga);
      transition: background-color var(--transicion-suave), box-shadow var(--transicion-suave);
      font-size: 1.5rem;
    }

    .cambiar-tema:hover {
      background-color: var(--boton-oscuro);
      box-shadow: 0 4px 16px var(--sombra-oscura);
    }

    /* Tema oscuro */
    body.tema-oscuro {
      background-color: var(--fondo-oscuro);
      color: var(--texto-oscuro);
    }

    body.tema-oscuro #comentarios {
      background-color: var(--comentario-oscuro);
      box-shadow: 0 4px 20px var(--sombra-oscura);
    }

    body.tema-oscuro .comentario {
      background: var(--comentario-oscuro);
      border-left: 6px solid var(--borde-oscuro);
    }

    body.tema-oscuro .cambiar-tema {
      background-color: var(--boton-oscuro);
      color: var(--texto-oscuro);
    }

    body.tema-oscuro .cambiar-tema:hover {
      background-color: #444;
    }

    /* Estilo para los navegadores Webkit (Chrome, Safari) */
    #comentarios::-webkit-scrollbar {
      display: none;
    }

    /* Estilo de las estad칤sticas */
    #estadisticas {
      width: 85%;
      max-width: 900px;
      margin-top: 20px;
      padding: 20px;
      background-color: var(--comentario-claro);
      border-radius: 12px;
      box-shadow: 0 4px 20px var(--sombra-larga);
      text-align: center;
      transition: background-color var(--transicion-suave), box-shadow var(--transicion-suave);
    }

    /* Estilo de las estad칤sticas en tema oscuro */
    body.tema-oscuro #estadisticas {
      background-color: var(--comentario-oscuro);
      box-shadow: 0 4px 20px var(--sombra-oscura);
    }
  </style>
</head>
<body>
  <h2>Comentarios de los ciudadanos</h2>
  <div id="comentarios">Cargando comentarios...</div>   
  <div id="estadisticas">Cargando estad칤sticas...</div>
  <button class="cambiar-tema" onclick="cambiarTema()">游깿</button>

  <script>
    async function obtenerComentarios() {
      try {
      const response = await fetch('https://mquzx.top/api/comentarios');
      if (!response.ok) throw new Error("Error en la petici칩n");
      const data = await response.json();
  
      mostrarComentarios(data.comentarios);
      mostrarEstadisticas(data.estadisticas.respuestasSi, data.estadisticas.respuestasNo);
      } catch (error) {
      console.error("Error:", error);
      document.getElementById("comentarios").innerHTML = "<p>Error al cargar los comentarios.</p>";
      }
    }
  
    function formatoComentario(comentario) {
      return comentario.replace(/\n/g, '<br>');
    }
  
    function mostrarComentarios(comentarios) {
      if (comentarios.length === 0) {
      document.getElementById("comentarios").innerHTML = "<p>No hay comentarios a칰n.</p>";
      return;
      }
      document.getElementById("comentarios").innerHTML = `<div class="comentario"><p><strong>${comentarios[0].autor}:</strong> ${formatoComentario(comentarios[0].texto)}</p></div>`;
      let indiceComentario = 1;
      setInterval(() => {
      if (indiceComentario < comentarios.length) {
        const comentario = comentarios[indiceComentario];
        document.getElementById("comentarios").innerHTML = `<div class="comentario"><p><strong>${comentario.autor}:</strong> ${formatoComentario(comentario.texto)}</p></div>`;
        indiceComentario++;
      } else {
        indiceComentario = 0;
      }
      }, 14000);
    }
  
    function mostrarEstadisticas(respuestasSi, respuestasNo) {
      const total = respuestasSi + respuestasNo;
      const porcentajeSi = total > 0 ? ((respuestasSi / total) * 100).toFixed(2) : 0;
      const porcentajeNo = total > 0 ? ((respuestasNo / total) * 100).toFixed(2) : 0;
  
      document.getElementById("estadisticas").innerHTML = `
      <p><strong>Estad칤sticas de la pregunta:</strong></p>
      <p>쮸poyas la solicitud para reinstalar la iluminaci칩n en la pista de skate?</p>
      <p><strong>S칤:</strong> ${respuestasSi} (${porcentajeSi}%) | <strong>No:</strong> ${respuestasNo} (${porcentajeNo}%)</p>
      `;
    }
  
    // Funci칩n para actualizar estad칤sticas en tiempo real
    function actualizarEstadisticasTiempoReal() {
      setInterval(async () => {
      try {
        const response = await fetch('https://mquzx.top/api/comentarios');
        if (!response.ok) throw new Error("Error en la petici칩n");
        const data = await response.json();
  
        mostrarEstadisticas(data.estadisticas.respuestasSi, data.estadisticas.respuestasNo);
      } catch (error) {
        console.error("Error al actualizar estad칤sticas:", error);
      }
      }, 7000);
    }
  
    function cambiarTema() {
      document.body.classList.toggle('tema-oscuro');
      const icono = document.querySelector('.cambiar-tema');
      icono.textContent = document.body.classList.contains('tema-oscuro') ? '游' : '游깿';
    }
  
    function establecerTemaSegunSistema() {
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.body.classList.add('tema-oscuro');
      }
    }
  
    establecerTemaSegunSistema();
    obtenerComentarios();
    actualizarEstadisticasTiempoReal();
    </script>
</body>
</html>
